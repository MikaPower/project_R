



  <h3 align="center">Table tennis data filtering and process</h3>

  <p align="center">
    Drop and paste data and magic happens 
  </p>




<!-- TABLE OF CONTENTS -->
<details open="open">
  <summary>Table of Contents</summary>
  <ol>
    <li>
      <a href="#about-the-project">About The Project</a>
    </li>
    <li>
          <a href="#folders">Folders</a>
    </li>
    <li>
      <a href="#r-files">R files</a>
    </li>
    <li><a href="#contact">Contact</a></li>
  </ol>
</details>



<!-- ABOUT THE PROJECT -->
## About The Project

<!--[![Product Name Screen Shot][product-screenshot]](https://example.com)-->

This project contains the filtering and processing of 2 Datasets, one slow, one fast. From them, 3 more datasets were created based on a movement detection cut algorithms

The project is divided in Folders and R files
## Folders
To insert new data captured from sensorlog with the csv separator |, use the folder thesis/movements
Data should be divided in train and test folders and with the corresponding movement label directory.

Example:


~~~
 movements : * Train/
                * bloco/
                    *  2021-04-09_.csv
                    *  2021-04-09_.csv
             * Test/
                * bloco/
                    *  2021-04-09_.csv
                    *  2021-04-09_.csv
  ~~~              

Data generated by the R files can be found on ..thesis/saved/* folder
The data generated follows the same folder principle as the above mentioned

Also data generated graphics can be found on thesis/saved/train/photos and thesis/saved/test/photos


## R Files
There's multiple R files. Below is a description of what each one does:

 * "thesis_v2.R" =  Removes unnecessary columns, normalizes the timestamp, creates graphics based on defined timestamps and produces a csv file for 
 each recorded input.
 
 * "thesis_watch_graphs.R" = Removes unnecessary columns, normalizes the timestamp, creats graphics from data recorded files inserted on folder 
 thesis/misc/modes and outputs the graphics to thesis/misc/graphs

* "thesis_with_cuts_and_files_python.R" = Removes unnecessary columns, normalizes the timestamp, creates graphics based on defined timestamps, applies a 
                        stroke detection algorithm based on peak acceleration, each stroke has a defined threshold and a corresponding axis. 
                        This parameters can be changed to fit new purposes. It produces a csv file containing 46 frames of data (enough for a stroke recognition) for each stroke detected during the input session recorded
                        Use this one to create the dataset to be used in Create ML
                        
* "thesis_with_cuts_and_files_python_all_axis_modelv2_no_rest.R" = The same as thesis_with_cuts_and_files_python.R but instead of a single file per movement 
detected, it generates 6 files(one for each axis) with rows containing 47 (columns), 46 columns represent the stroke movement, the 47th represent the stroke id
and each row represents a stroke performed. Does not create rest samples. This input can be used for CNN-LSTM and convLSTM models. The output can be found
on data/thesis/full_df

* "thesis_with_cuts_and_files_python_all_axis_modelv4_diff_rest.R" = The same as thesis_with_cuts_and_files_python_all_axis_modelv2_no_rest.R but generates
rest samples from the stroke detection algorithm everytime every frame not containing a peak acceleration. The rest samples are also based on each movement.
 This input is the perfect to be used for CNN-LSTM and convLSTM models and it was the used on the pre defined models. The output can be found on 
 data/thesis/full_df                                                                                                                                   
     
* "thesis_with_cuts_same_folder.R" = Removes unnecessary columns, normalizes the timestamp, uses the stroke detection algorithm, produces no rest samples.
The only difference is that it produces the output in a single folder. No transpose happens

The outputs of each R file goes to either data/thesis/saved for Create ML, or data/thesis/full_df if the data is to be used on CNN-LSTM or ConvLSTM models.

The remaining R files can be ignored.



Some values such as paths, threshold,s stroke labels id, the amount of frames for the stroke cut algorithm, the axis in which the algorithm works can be changed

## Values to change FAQ
**Question:** I'm gettings error running the project?

**Answer:**  Make sure you change the line to your current project path
  ```
path <- '/Users/nuno/IdeaProjects/project_R/data/thesis/'
  ```
Also if this doesn't fix it, try to use the debug on code lines based on paths, and make sure you have the folders necessary.

**Question:** I want to change the number of data frames on the stroke detection algorithm

**Answer:**  Look for this line of code and change the number                                                                       
 ```
            mini_sub <- data[row:(row+45),]
            row <- row+45
 ```
Also search for the number 45 and 46 and replace with the number you want


**Question:** I want to change the threshold of the peak stroke detection algorithm 

**Answer:**  Look for this line of code and change the number for each stroke label, the current its 1 G(s) gforce

      limit_val <- switch(class, "bloco" = 1, "flip_direita" = 1, "flip_esquerda" = 1, "top_spin_esquerda" = 1, "top_spin_direita" = 1)

**Question:** I want to change the label id (used for CNN-LSTM and convLSTM) 

**Answer:**  Look for this line of code and change the number,

        label_name <- switch(class, "bloco" = 2, "flip_direita" = 3, "flip_esquerda" = 4, "top_spin_esquerda" = 1, "top_spin_direita" = 0)
if the file also produces Rest samples, and you also want to change the Rest class id, look for this line and change the 5 to the id you want
        
        label <- matrix(rep(5, 1), nrow(small_matrix))
        
**Question:** I want to change the axis that the stroke peak acceleration stroke detection uses for each stroke label. 

**Answer:**  Look for this line of code and change the letter before the ".G.", to either X,Y,Z

        limit_axis <- switch(class, "bloco" = 'motionUserAccelerationZ.G.', "flip_direita" = 'motionUserAccelerationX.G.', "flip_esquerda" = 'motionUserAccelerationZ.G.', "top_spin_esquerda" = 'motionUserAccelerationZ.G.', "top_spin_direita" = 'motionUserAccelerationX.G.')

**Question:** I want to do nothing. 

**Answer:**  Search for the project in finder, and use COMAND+ BACKSPACE to delete the project :)



<!-- CONTACT -->
## Contact

Nuno Ferreira  - 35053@ufp.edu.pt or nunoalf@hotmail.com










